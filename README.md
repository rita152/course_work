# 投资组合选择优化系统

基于平均绝对偏差(MAD)风险度量的投资组合优化系统

---

## 1. 问题描述

### 1.1 背景

投资组合选择是金融领域的核心问题之一。每个投资者都需要在多个可选资产中决定如何分配资金，以实现收益最大化和风险最小化的平衡。

本项目基于 Vanderbei 教材《Linear Programming: Foundations and Extensions》第13章的Portfolio Selection问题，使用线性规划方法求解投资组合优化问题。

### 1.2 数据说明

使用教材Table 13.1中的真实金融数据：
- **数据来源**: 9个投资标的的月度收益率数据
- **时间跨度**: 2005年5月至2007年4月（共24个月）
- **投资标的**:
  - SHY: 短期国债基金（3年期）
  - XLB: 材料行业ETF
  - XLE: 能源行业ETF
  - XLF: 金融行业ETF
  - XLI: 工业行业ETF
  - XLK: 科技行业ETF
  - XLP: 日用消费品ETF
  - XLU: 公用事业ETF
  - XLV: 医疗保健ETF

每个数据点表示：每投资1美元，在该月末的价值（例如1.068表示收益率为6.8%）。

---

## 2. 数学模型

### 2.1 符号定义

- \( R_j(t) \): 资产 \( j \) 在第 \( t \) 期的收益率
- \( r_j = \frac{1}{T} \sum_{t=1}^{T} R_j(t) \): 资产 \( j \) 的期望收益
- \( D_{tj} = R_j(t) - r_j \): 资产 \( j \) 在第 \( t \) 期的收益偏差
- \( x_j \): 投资在资产 \( j \) 上的比例（决策变量）
- \( \mu \): 风险厌恶参数（控制收益和风险的权衡）

### 2.2 原始优化问题（公式13.1）

投资组合选择问题可以表述为：

```
maximize    μ · Σ(x_j · r_j) - E|Σ(x_j · R̃_j)|

subject to  Σ(x_j) = 1
            x_j ≥ 0,  j = 1, 2, ..., n
```

其中：
- **目标函数第一项**: \( \mu \cdot \sum_j x_j r_j \) 表示投资组合的期望收益
- **目标函数第二项**: \( \mathbb{E}|\sum_j x_j \tilde{R}_j| \) 表示MAD风险（平均绝对偏差）
- **约束条件**: 投资比例之和为1，且所有比例非负

参数 \( \mu \) 的作用：
- \( \mu \) 越大：越重视收益，愿意承担更高风险
- \( \mu \) 越小：越重视风险控制，接受较低收益

### 2.3 线性化模型（公式13.3）

通过引入辅助变量 \( y_t \) 来表示绝对值，将问题转化为标准线性规划：

```
maximize    μ · Σ(x_j · r_j) - (1/T) · Σ(y_t)

subject to  -y_t ≤ Σ(x_j · D_tj) ≤ y_t,  t = 1, 2, ..., T
            Σ(x_j) = 1
            x_j ≥ 0,  j = 1, 2, ..., n
            y_t ≥ 0,  t = 1, 2, ..., T
```

**变量说明**:
- 决策变量: \( x_1, x_2, ..., x_n \) (n=9个资产的投资比例)
- 辅助变量: \( y_1, y_2, ..., y_T \) (T=24个时期的绝对偏差)
- 总变量数: n + T = 9 + 24 = 33个
- 约束数: 2T + 1 = 49个

**线性化技巧**:
- 原问题中的绝对值 \( |\sum_j x_j D_{tj}| \) 不是线性的
- 通过引入 \( y_t \geq |\sum_j x_j D_{tj}| \)，等价于两个线性不等式
- 由于目标函数最小化 \( y_t \)，最优解处 \( y_t = |\sum_j x_j D_{tj}| \)

### 2.4 MAD风险 vs 方差风险

传统的Markowitz模型使用方差作为风险度量：

| 风险度量 | 数学表达 | 优点 | 缺点 |
|---------|---------|------|------|
| MAD | \( \frac{1}{T}\sum_t \|\sum_j x_j D_{tj}\| \) | 线性规划，求解快速 | 不可微 |
| 方差 | \( \mathbb{E}[(\sum_j x_j \tilde{R}_j)^2] \) | 理论性质好 | 二次规划，求解较慢 |

本项目实现两种模型，并进行对比分析。

---

## 3. 求解方法

### 3.1 求解器选择

使用 **PuLP** Python建模包和 **CBC** 求解器：
- PuLP: 开源线性规划建模包
- CBC (Coin-or Branch and Cut): 开源线性规划求解器
- 优点: 免费、易于安装、性能优秀

### 3.2 PuLP建模步骤

```python
from pulp import *

# 1. 创建问题
prob = LpProblem("Portfolio_MAD", LpMaximize)

# 2. 定义决策变量
x = [LpVariable(f"x_{j}", lowBound=0) for j in range(n)]
y = [LpVariable(f"y_{t}", lowBound=0) for t in range(T)]

# 3. 设置目标函数
prob += mu * lpSum([r[j] * x[j] for j in range(n)]) - (1/T) * lpSum(y)

# 4. 添加约束
prob += lpSum(x) == 1  # 预算约束
for t in range(T):
    deviation = lpSum([D[t,j] * x[j] for j in range(n)])
    prob += deviation <= y[t]   # 上界
    prob += deviation >= -y[t]  # 下界

# 5. 求解
prob.solve(PULP_CBC_CMD(msg=0))
```

### 3.3 参数化求解

为了得到完整的有效前沿（Efficient Frontier），需要对不同的 \( \mu \) 值求解：
- 使用对数尺度：\( \mu \in [0.1, 1, 10, 100, ...] \)
- 每个 \( \mu \) 值对应有效前沿上的一个点
- 将所有点连接，得到完整的风险-收益曲线

---

## 4. 使用说明

### 4.1 环境配置

**系统要求**:
- Python 3.7+
- Conda环境管理器

**安装步骤**:

```bash
# 1. 激活conda环境
conda activate cource_work

# 2. 进入项目目录
cd portfolio_selection

# 3. 安装依赖包
pip install -r requirements.txt
```

**依赖包列表**:
- pulp >= 2.7.0 (线性规划建模)
- pandas >= 1.5.0 (数据处理)
- numpy >= 1.23.0 (数值计算)
- matplotlib >= 3.6.0 (绘图)
- seaborn >= 0.12.0 (高级可视化)

### 4.2 代码运行

**运行主程序**:
```bash
cd src
python main.py
```

**运行单个模块**（测试用）:
```bash
# 测试数据处理模块
python data_processor.py

# 测试MAD优化模块
python mad_optimizer.py

# 测试方差优化模块
python variance_optimizer.py
```

### 4.3 输出结果

程序运行后，会在 `results/` 目录生成以下文件：

**图表文件**:
- `efficient_frontier.png`: 有效前沿图（风险-收益曲线）
- `portfolio_composition.png`: 不同μ值下的投资组合配置
- `mu_sensitivity.png`: μ参数敏感性分析（4个子图）
- `portfolio_pie_mu_X.png`: 特定μ值的投资组合饼图
- `correlation_heatmap.png`: 资产相关系数热力图
- `model_comparison.png`: MAD vs 方差模型对比

**数据文件**:
- `mad_results_summary.csv`: MAD模型优化结果汇总表
- `variance_results_summary.csv`: 方差模型优化结果汇总表

### 4.4 参数调整

在 `main.py` 中可以调整以下参数：

```python
# μ值范围和数量
mu_values = np.logspace(-1, 2.5, 30)  # 30个点，从0.1到316

# 可视化中展示的组合数量
selected_indices = range(0, len(results), len(results)//15)  # 展示15个
```

---

## 5. 结果分析

### 5.1 有效前沿解读

**有效前沿（Efficient Frontier）**是所有帕累托最优投资组合的集合。在有效前沿上的任何一点，满足：
- 在相同风险水平下，收益最高
- 在相同收益水平下，风险最低

**主要发现**:
1. **分散投资优势**: 通过合理配置多个资产，可以在不降低收益的情况下显著降低风险
2. **风险-收益权衡**: 更高的期望收益必然伴随更高的风险
3. **单资产组合劣势**: 所有单资产投资组合都不在有效前沿上，说明它们是次优的

### 5.2 参数μ的影响

\( \mu \) 参数控制投资者的风险偏好：

| μ值 | 投资风格 | 组合特征 |
|-----|---------|---------|
| 0.1 - 1 | 极度保守 | 集中于低风险资产（如债券SHY），风险最小 |
| 1 - 10 | 保守 | 较均衡配置，倾向稳定行业 |
| 10 - 50 | 平衡 | 多元化配置，平衡风险和收益 |
| 50 - 100 | 激进 | 集中于高收益行业（如能源XLE） |
| > 100 | 极度激进 | 几乎全部投资于期望收益最高的单一资产 |

**关键观察**:
- μ越大，投资组合的期望收益单调递增
- μ越大，投资组合的MAD风险也单调递增
- 存在一个临界点，超过该点后，继续增加μ对收益提升有限，但风险急剧上升

### 5.3 模型对比结论

**MAD模型 vs 方差模型**:

1. **有效前沿形状**: 
   - 两种模型的有效前沿非常接近
   - MAD模型倾向于产生更分散的投资组合
   - 方差模型对极端值更敏感

2. **计算效率**:
   - MAD模型：线性规划，求解速度快（通常<0.1秒/问题）
   - 方差模型：需要近似求解二次规划，速度较慢

3. **实际应用**:
   - MAD更适合大规模问题（资产数量多）
   - 方差在理论分析中更常用（便于推导）

### 5.4 资产相关性分析

**高正相关资产对**（同涨同跌）:
- 同属于经济周期敏感行业（如材料、能源、工业）
- 不适合组合在一起对冲风险

**低相关或负相关资产对**（对冲效果好）:
- 债券(SHY) vs 股票ETF
- 防御性行业(公用事业XLU、日用消费品XLP) vs 周期性行业(能源XLE、材料XLB)

**分散投资建议**:
- 组合应包含相关性低的资产
- 在不同经济周期中表现互补的行业
- 适当配置债券等低风险资产

### 5.5 投资建议

**根据风险承受能力选择**:

1. **保守型投资者** (风险厌恶):
   - 推荐μ = 1-5
   - 配置建议: SHY(30-50%), XLP(20-30%), XLU(10-20%), 其他(10-30%)
   - 预期年化收益: 0-2%
   - 预期风险: MAD < 0.02

2. **平衡型投资者** (中等风险):
   - 推荐μ = 10-30
   - 配置建议: 多元化配置9个资产，每个5-20%
   - 预期年化收益: 2-4%
   - 预期风险: MAD 0.02-0.03

3. **激进型投资者** (风险偏好):
   - 推荐μ = 50-100
   - 配置建议: XLE(30-40%), XLK(20-30%), XLV(10-20%), 其他(10-30%)
   - 预期年化收益: 4-6%
   - 预期风险: MAD > 0.03

**重要提醒**:
- 历史收益不代表未来表现
- 模型基于历史数据，市场环境变化可能导致结果失效
- 建议定期（如每季度）重新优化投资组合
- 考虑交易成本和税收影响

---

## 6. 项目结构

```
portfolio_selection/
├── data/
│   └── returns_data.csv          # 历史收益率数据
├── src/
│   ├── data_processor.py         # 数据加载和预处理模块
│   ├── mad_optimizer.py          # MAD优化模型
│   ├── variance_optimizer.py     # 方差优化模型
│   ├── visualization.py          # 可视化模块
│   └── main.py                   # 主程序
├── results/                      # 结果输出目录
│   ├── *.png                     # 各种图表
│   └── *.csv                     # 结果数据表
├── requirements.txt              # Python依赖包
└── README.md                     # 本文档
```

---

## 7. 技术特点

1. **完整的线性规划建模**: 严格按照教材公式(13.3)实现
2. **高效求解**: 使用开源CBC求解器，性能优秀
3. **参数化分析**: 自动计算完整有效前沿
4. **对比分析**: 实现MAD和方差两种模型，便于比较
5. **丰富可视化**: 生成多种图表，全面展示结果
6. **代码结构清晰**: 模块化设计，易于理解和扩展

---

## 8. 参考文献

1. Vanderbei, R. J. (2020). *Linear Programming: Foundations and Extensions* (5th ed.). Springer.
   - Chapter 13: Financial Applications - Portfolio Selection

2. Markowitz, H. (1952). Portfolio Selection. *The Journal of Finance*, 7(1), 77-91.

3. Konno, H., & Yamazaki, H. (1991). Mean-Absolute Deviation Portfolio Optimization Model and Its Applications to Tokyo Stock Market. *Management Science*, 37(5), 519-531.

---

## 9. 作者信息

**课程**: 线性规划及应用
**作业**: 课程大作业一 - Portfolio Selection
**时间**: 2025年10月

---

## 10. 常见问题

**Q1: 为什么选择MAD而不是方差？**
A: MAD可以用线性规划求解，比方差的二次规划更快，特别是在大规模问题中。

**Q2: 如何选择合适的μ值？**
A: 没有绝对的"正确"μ值，应根据个人风险承受能力选择。可以从有效前沿上选择满意的风险-收益组合。

**Q3: 历史数据有多可靠？**
A: 历史数据提供参考，但不能保证未来。建议定期更新数据和重新优化。

**Q4: 可以添加更多资产吗？**
A: 可以。只需修改`returns_data.csv`文件，添加新资产的历史收益率列即可。

**Q5: 如何考虑交易成本？**
A: 当前模型未包含交易成本。可以在目标函数中添加惩罚项，或限制投资组合调整幅度。

---

## 附录：数学推导

### A. 绝对值的线性化

对于 \( z = |x| \)，引入变量 \( y \geq 0 \)，以下约束等价：

```
y ≥ |x|  ⟺  y ≥ x 且 y ≥ -x
```

在最小化 \( y \) 的目标下，最优解满足 \( y = |x| \)。

### B. MAD风险的计算

投资组合的MAD风险：

```
MAD = (1/T) Σ_t |Σ_j x_j (R_j(t) - r_j)|
    = (1/T) Σ_t |Σ_j x_j D_tj|
```

通过引入 \( y_t \geq |\sum_j x_j D_{tj}| \)，转化为：

```
minimize (1/T) Σ_t y_t
subject to  -y_t ≤ Σ_j x_j D_tj ≤ y_t
```

---

**祝使用愉快！如有问题，欢迎交流讨论。**

